<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Wallet Platform</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    #dashboard, #transfer-section, #admin-section { display: none; margin-top: 20px; }
    input, select { padding: 5px; margin: 5px 0; width: 100%; }
    button { padding: 8px 16px; margin-top: 10px; }
    .hidden { display: none; }
  </style>
</head>
<body>

  <h2>Login</h2>
  <input id="login-username" placeholder="Username">
  <input id="login-password" placeholder="Password" type="password">
  <button onclick="login()">Login</button>

  <div id="dashboard">
    <h2>Welcome, <span id="user-display"></span></h2>
    <p><strong>Wallet Number:</strong> <span id="wallet-number"></span></p>
    <p><strong>Balance:</strong> <span id="user-balance"></span></p>
    <button onclick="logout()">Logout</button>

    <div id="transfer-section">
      <h3>Send Money</h3>
      <input id="recipient-wallet" placeholder="Recipient Wallet Number">
      <input id="amount" type="number" placeholder="Amount to Send">
      <select id="currency-from"></select>
      <select id="currency-to"></select>
      <button onclick="transfer()">Send</button>
      <p id="conversion-info"></p>
    </div>

    <div id="admin-section">
      <h3>Admin Panel</h3>
      <pre id="admin-data"></pre>
    </div>
  </div>

  <script>
    const users = {
      kilush: { password: '1234', balance: 10000, wallet: 'WALLET-KIL123', currency: 'KES' },
      schwadz: { password: '4321', balance: 12000, wallet: 'WALLET-SCH321', currency: 'USD' },
      moses: { password: '2468', balance: 8500, wallet: 'WALLET-MOS468', currency: 'EUR' },
      admin: { password: 'adminpass', balance: 99999, wallet: 'WALLET-ADM001', currency: 'USD', admin: true }
    };

    let currentUser = null;

    function populateCurrencies() {
      const currencyList = [
        'KES','USD','EUR','GBP','JPY','INR','CNY','CAD','AUD','NGN','ZAR','UGX','TZS','GHS','BRL','CHF','SEK','NOK','RUB','KRW'
      ];
      const from = document.getElementById('currency-from');
      const to = document.getElementById('currency-to');
      currencyList.forEach(code => {
        from.add(new Option(code, code));
        to.add(new Option(code, code));
      });
      from.value = 'KES';
      to.value = 'USD';
    }

    function login() {
      const uname = document.getElementById('login-username').value.toLowerCase();
      const pwd = document.getElementById('login-password').value;
      const user = users[uname];

      if (user && user.password === pwd) {
        currentUser = uname;
        document.getElementById('dashboard').style.display = 'block';
        document.getElementById('user-display').innerText = uname;
        document.getElementById('wallet-number').innerText = user.wallet;
        updateBalanceDisplay();
        document.getElementById('transfer-section').style.display = 'block';
        if (user.admin) {
          document.getElementById('admin-section').style.display = 'block';
          showAdminData();
        }
      } else {
        alert("Invalid login credentials.");
      }
    }

    function logout() {
      currentUser = null;
      document.getElementById('dashboard').style.display = 'none';
      document.getElementById('login-username').value = '';
      document.getElementById('login-password').value = '';
    }

    function updateBalanceDisplay() {
      const user = users[currentUser];
      document.getElementById('user-balance').innerText = `${user.balance.toFixed(2)} ${user.currency}`;
    }

    async function transfer() {
      const recipientWallet = document.getElementById('recipient-wallet').value.trim();
      const amount = parseFloat(document.getElementById('amount').value);
      const fromCurrency = document.getElementById('currency-from').value;
      const toCurrency = document.getElementById('currency-to').value;

      if (!recipientWallet || isNaN(amount) || amount <= 0) {
        alert("Please enter all fields correctly.");
        return;
      }

      const sender = users[currentUser];
      const recipientEntry = Object.entries(users).find(([_, data]) => data.wallet === recipientWallet);
      if (!recipientEntry) {
        alert("Recipient wallet not found.");
        return;
      }

      const [recipientName, recipient] = recipientEntry;

      if (sender.balance < amount) {
        alert("Insufficient balance.");
        return;
      }

      try {
        const response = await fetch(`https://api.exchangerate.host/convert?from=${fromCurrency}&to=${toCurrency}&amount=${amount}`);
        const result = await response.json();
        const converted = result.result;

        // Debit sender
        sender.balance -= amount;

        // Credit recipient
        recipient.balance += converted;

        updateBalanceDisplay();
        document.getElementById('conversion-info').innerText =
          `Sent ${amount} ${fromCurrency} to ${recipient.wallet}, converted to ${converted.toFixed(2)} ${toCurrency}`;

        if (sender.admin) showAdminData();

      } catch (error) {
        alert("Currency conversion failed.");
      }
    }

    function showAdminData() {
      let output = "=== USER BALANCES ===\n";
      for (const [username, data] of Object.entries(users)) {
        output += `${username}: ${data.balance.toFixed(2)} ${data.currency} (${data.wallet})\n`;
      }
      document.getElementById('admin-data').innerText = output;
    }

    populateCurrencies();
  </script>

</body>
</html>
