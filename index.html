<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Multi-Currency Wallet Platform</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    .hidden { display: none; }
    input, select, button { margin: 5px; padding: 6px; }
    #confirmation-section { border: 1px solid #ccc; padding: 10px; margin-top: 10px; }
    canvas { max-width: 400px; margin: 10px 0; }
    #transaction-log { max-height: 150px; overflow-y: scroll; border: 1px solid #ccc; padding: 5px; margin-top: 10px; font-size: 12px; }
    #admin-panel, #subadmin-panel { border: 1px solid #000; padding: 10px; margin-top: 15px; background: #f9f9f9; }
    #admin-panel h3, #subadmin-panel h3 { margin-top: 0; }
    label { font-size: 12px; }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body onload="initApp()">

  <h2>Multi-Currency Wallet Platform</h2>

  <div id="start-section">
    <button onclick="showSection('login-section')">Login</button>
    <button onclick="showSection('register-section')">Register</button>
  </div>

  <div id="register-section" class="hidden">
    <h3>Register</h3>
    <input id="reg-username" placeholder="Username" />
    <input id="reg-password" type="password" placeholder="Password" />
    <label><input type="checkbox" onclick="togglePassword('reg-password')"> Show Password</label><br>
    <input id="reg-email" placeholder="Email" />
    <input id="reg-pin" placeholder="PIN (4 digits)" maxlength="4" />
    <select id="currency"></select><br>
    <select id="country"></select><br>
    <button onclick="register()">Register</button>
    <button onclick="showSection('start-section')">Back</button>
  </div>

  <div id="login-section" class="hidden">
    <h3>Login</h3>
    <input id="login-username" placeholder="Username" />
    <input id="login-password" type="password" placeholder="Password" />
    <label><input type="checkbox" onclick="togglePassword('login-password')"> Show Password</label><br>
    <button onclick="login()">Login</button>
    <button onclick="showSection('start-section')">Back</button>
  </div>

  <div id="user-panel" class="hidden">
    <h3>Welcome, <span id="current-username"></span>!</h3>
    <p><b>Role:</b> <span id="current-role"></span></p>

    <div id="wallet-balances"></div>

    <h4>Send Money</h4>
    <select id="send-currency"></select>
    <input id="send-amount" type="number" placeholder="Amount" min="0" step="0.01" />
    <input id="send-recipient" placeholder="Recipient Username" />
    <button onclick="sendMoney()">Send</button>

    <h4>Transaction Log</h4>
    <div id="transaction-log"></div>

    <button onclick="logout()">Logout</button>
  </div>

  <div id="admin-panel" class="hidden">
    <h3>Admin Panel</h3>
    <p><b>Transaction Wallet Balances:</b> <span id="admin-transaction-balance"></span></p>
    <p><b>Trading Wallet Balances:</b> <span id="admin-trading-balance"></span></p>

    <button onclick="moveFeesToTrading()">Move Fees to Trading Wallet</button>

    <h4>Transaction Fees Collected (per currency)</h4>
    <canvas id="feesChart" width="400" height="200"></canvas>
  </div>

  <div id="subadmin-panel" class="hidden">
    <h3>Sub-Admin Panel</h3>
    <p><b>Transaction Wallet Balances:</b> <span id="subadmin-transaction-balance"></span></p>
    <p><b>Trading Wallet Balances:</b> <span id="subadmin-trading-balance"></span></p>
  </div>

  <script>
    const countries = ["Kenya", "Uganda", "USA", "UK", "Germany"];
    const currencies = ["KES", "UGX", "USD", "GBP", "EUR"];

    const exchangeRates = {
      "KES": 1,
      "USD": 0.0085,
      "EUR": 0.0078,
      "UGX": 34.5,
      "GBP": 0.0067
    };

    const users = {};
    const transactions = [];
    const adminWallets = {
      transactionWallet: { KES: 0, USD: 0, EUR: 0, UGX: 0, GBP: 0 },
      tradingWallet: { KES: 0, USD: 0, EUR: 0, UGX: 0, GBP: 0 }
    };

    let currentUser = null;

    function initApp() {
      showSection('start-section');
      populateCurrencies();
      populateCountries();
      fetchExchangeRates();
    }

    function togglePassword(fieldId) {
      const field = document.getElementById(fieldId);
      field.type = field.type === "password" ? "text" : "password";
    }

    function populateCurrencies() {
      const currencySelects = document.querySelectorAll("#currency, #send-currency");
      currencySelects.forEach(select => {
        select.innerHTML = "";
        currencies.forEach(c => {
          const option = document.createEl
