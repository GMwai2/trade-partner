<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Multi-Currency Wallet Platform</title>
<style>
  body { font-family: Arial, sans-serif; margin: 20px; }
  .wallet, .transfer, .admin, .confirmation-popup {
    border: 1px solid #ccc; padding: 15px; margin-bottom: 20px;
  }
  .hidden { display: none; }
  label { display: block; margin-top: 10px; }
  input, select { width: 100%; padding: 8px; margin-top: 5px; }
  button { margin-top: 15px; padding: 10px 15px; cursor: pointer; }
  #confirmation-popup {
    position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
    background: rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center;
  }
  #confirmation-content {
    background: white; padding: 20px; border-radius: 5px; width: 300px;
  }
</style>
</head>
<body>

<h1>Multi-Currency Wallet Platform</h1>

<div class="wallet">
  <h2>Your Wallets</h2>
  <div id="wallet-balances"></div>
</div>

<div class="transfer">
  <h2>Send Money</h2>
  <label for="sender-currency">From Currency:</label>
  <select id="sender-currency"></select>

  <label for="recipient-account">Recipient Account Number:</label>
  <input type="text" id="recipient-account" placeholder="Enter recipient account number" />

  <label for="recipient-currency">Recipient Currency:</label>
  <select id="recipient-currency"></select>

  <label for="transfer-amount">Amount to Send:</label>
  <input type="number" id="transfer-amount" min="0" step="0.01" placeholder="Amount" />

  <button id="initiate-transfer-btn">Send Money</button>
</div>

<div id="confirmation-popup" class="hidden">
  <div id="confirmation-content">
    <h3>Confirm Transfer</h3>
    <p id="confirmation-details"></p>
    <label for="pin-input">Enter PIN to authorize:</label>
    <input type="password" id="pin-input" maxlength="6" />
    <button id="confirm-transfer-btn">Confirm Transfer</button>
    <button id="cancel-transfer-btn">Cancel</button>
  </div>
</div>

<div class="admin">
  <h2>Admin Dashboard</h2>
  <div id="admin-info">
    <p><strong>Transaction Wallet (EUR):</strong> <span id="transaction-wallet">0.00</span> EUR</p>
    <p><strong>Trading Wallet (EUR):</strong> <span id="trading-wallet">0.00</span> EUR</p>
  </div>
</div>

<script>
  // Mock user wallets with balances
  const userWallets = {
    USD: 1000.00,
    EUR: 800.00,
    KES: 50000.00,
    GBP: 700.00
  };

  // Mock admin wallets
  let adminTransactionWalletEUR = 0.00;
  let adminTradingWalletEUR = 0.00;

  // Mock exchange rates (1 unit of key currency to EUR)
  const exchangeRatesToEUR = {
    USD: 0.91,
    EUR: 1,
    KES: 0.0069,
    GBP: 1.14
  };

  // Transaction fee: 0.5% for transfers >= KES 250 equivalent, capped at KES 1000 equivalent
  // All fees go to adminTransactionWalletEUR

  // Populate currency selectors
  const senderCurrencySelect = document.getElementById('sender-currency');
  const recipientCurrencySelect = document.getElementById('recipient-currency');

  Object.keys(userWallets).forEach(currency => {
    const option1 = document.createElement('option');
    option1.value = currency;
    option1.textContent = currency;
    senderCurrencySelect.appendChild(option1);

    const option2 = document.createElement('option');
    option2.value = currency;
    option2.textContent = currency;
    recipientCurrencySelect.appendChild(option2);
  });

  // Display wallet balances
  function updateWalletDisplay() {
    const container = document.getElementById('wallet-balances');
    container.innerHTML = '';
    for (const [currency, balance] of Object.entries(userWallets)) {
      const p = document.createElement('p');
      p.textContent = `${currency}: ${balance.toFixed(2)}`;
      container.appendChild(p);
    }

    document.getElementById('transaction-wallet').textContent = adminTransactionWalletEUR.toFixed(2);
    document.getElementById('trading-wallet').textContent = adminTradingWalletEUR.toFixed(2);
  }

  updateWalletDisplay();

  // Conversion utility: amount from currency A to currency B
  function convertCurrency(amount, fromCurrency, toCurrency) {
    if(fromCurrency === toCurrency) return amount;
    // Convert to EUR first
    const amountInEUR = amount * exchangeRatesToEUR[fromCurrency];
    // Convert EUR to target currency
    return amountInEUR / exchangeRatesToEUR[toCurrency];
  }

  // Calculate fee in sender currency
  function calculateFee(amount, currency) {
    // Convert amount to KES equivalent
    const amountKES = convertCurrency(amount, currency, 'KES');
    if (amountKES < 250) return 0;
    // Fee is 0.5% capped at 1000 KES equivalent
    const feeKES = Math.min(amountKES * 0.005, 1000);
    // Convert fee back to sender currency
    return convertCurrency(feeKES, 'KES', currency);
  }

  // Transfer flow
  const initiateTransferBtn = document.getElementById('initiate-transfer-btn');
  const confirmationPopup = document.getElementById('confirmation-popup');
  const confirmationDetails = document.getElementById('confirmation-details');
  const pinInput = document.getElementById('pin-input');
  const confirmTransferBtn = document.getElementById('confirm-transfer-btn');
  const cancelTransferBtn = document.getElementById('cancel-transfer-btn');

  let pendingTransfer = null;

  initiateTransferBtn.addEventListener('click', () => {
    const senderCurrency = senderCurrencySelect.value;
    const recipientAccount = document.getElementById('recipient-account').value.trim();
    const recipientCurrency = recipientCurrencySelect.value;
    const amount = parseFloat(document.getElementById('transfer-amount').value);

    if (!recipientAccount) {
      alert('Please enter the recipient account number.');
      return;
    }
    if (isNaN(amount) || amount <= 0) {
      alert('Please enter a valid transfer amount.');
      return;
    }
    if (!userWallets.hasOwnProperty(senderCurrency)) {
      alert('Invalid sender currency.');
      return;
    }
    if (!userWallets.hasOwnProperty(recipientCurrency)) {
      alert('Invalid recipient currency.');
      return;
    }
    if (userWallets[senderCurrency] < amount) {
      alert('Insufficient balance in sender wallet.');
      return;
    }

    // Calculate fee and total deduction
    const fee = calculateFee(amount, senderCurrency);
    const totalDeduction = amount + fee;

    if (userWallets[senderCurrency] < totalDeduction) {
      alert(`Insufficient balance to cover amount plus fee (${fee.toFixed(2)} ${senderCurrency}).`);
      return;
    }

    // Prepare confirmation details
    const amountRecipient = convertCurrency(amount, senderCurrency, recipientCurrency);

    confirmationDetails.innerHTML = `
      <strong>From:</strong> Your Account<br/>
      <strong>To Account:</strong> ${recipientAccount}<br/>
      <strong>Send:</strong> ${amount.toFixed(2)} ${senderCurrency}<br/>
      <strong>Recipient Gets:</strong> ${amountRecipient.toFixed(2)} ${recipientCurrency}<br/>
      <strong>Transaction Fee:</strong> ${fee.toFixed(2)} ${senderCurrency}<br/>
      <strong>Total Deducted:</strong> ${(totalDeduction).toFixed(2)} ${senderCurrency}
    `;

    pinInput.value = '';
    pendingTransfer = {
      senderCurrency,
      recipientAccount,
      recipientCurrency,
      amount,
      fee,
      totalDeduction,
      amountRecipient
    };

    confirmationPopup.classList.remove('hidden');
  });

  confirmTransferBtn.addEventListener('click', () => {
    const pin = pinInput.value;
    if (pin.length === 0) {
      alert('Please enter your PIN.');
      return;
    }
    // For demo, any pin is accepted. Implement real PIN check as needed.

    // Perform transfer
    userWallets[pendingTransfer.senderCurrency] -= pendingTransfer.totalDeduction;

    // Normally, recipient would be updated in database; here we just log it.

    // Add fee to admin transaction wallet in EUR
    adminTransactionWalletEUR += pendingTransfer.fee * exchangeRatesToEUR[pendingTransfer.senderCurrency];

    updateWalletDisplay();
    confirmationPopup.classList.add('hidden');
    alert('Transfer successful.');

    pendingTransfer = null;
  });

  cancelTransferBtn.addEventListener('click', () => {
    confirmationPopup.classList.add('hidden');
    pendingTransfer = null;
  });
</script>

</body>
</html>
