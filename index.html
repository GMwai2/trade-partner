<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Trade Partner Wallet - Secure Access</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 600px;
      margin: 40px auto;
      padding: 20px;
      background-color: #f2f4f8;
      border-radius: 10px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
    }
    h2, h3 {
      text-align: center;
    }
    label, select, input, button {
      width: 100%;
      margin: 10px 0;
      padding: 10px;
    }
    .section {
      background: #ffffff;
      padding: 15px;
      border-radius: 8px;
      margin-top: 20px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    ul {
      padding-left: 20px;
    }
    #dashboard, #signup { display: none; }
  </style>
</head>
<body>
  <h2>Trade Partner Wallet</h2>

  <div class="section">
    <button onclick="toggleForm('login')">Login</button>
    <button onclick="toggleForm('signup')">Sign Up</button>
  </div>

  <div id="login" class="section">
    <h3>User Login</h3>
    <label for="loginUsername">Username:</label>
    <input type="text" id="loginUsername" placeholder="Enter username">
    <label for="loginPassword">Password:</label>
    <input type="password" id="loginPassword" placeholder="Enter password">
    <button onclick="login()">Login</button>
    <p id="loginStatus" style="color: red;"></p>
  </div>

  <div id="signup" class="section">
    <h3>Create New Account</h3>
    <label for="newUsername">Username:</label>
    <input type="text" id="newUsername" placeholder="Choose username">
    <label for="newPassword">Password:</label>
    <input type="password" id="newPassword" placeholder="Create password">
    <label for="email">Email:</label>
    <input type="email" id="email" placeholder="Enter email">
    <label for="preferredCurrency">Preferred Currency:</label>
    <select id="preferredCurrency"></select>
    <button onclick="signup()">Sign Up</button>
    <p id="signupStatus" style="color: green;"></p>
  </div>

  <div id="dashboard">
    <div class="section">
      <h3>Welcome, <span id="userDisplay"></span></h3>
      <h4>Your Wallet</h4>
      <ul id="walletList"></ul>
    </div>

    <div class="section">
      <h3>Send Money</h3>
      <label for="receiverName">Recipient Legal Name:</label>
      <input type="text" id="receiverName" placeholder="Full legal name">
      <label for="receiverWallet">Recipient Wallet Number:</label>
      <input type="text" id="receiverWallet" placeholder="Wallet ID">
      <label for="fromCurrency">From Currency:</label>
      <select id="fromCurrency"></select>
      <label for="toCurrency">To Currency:</label>
      <select id="toCurrency"></select>
      <label for="sendAmount">Amount to Send:</label>
      <input type="number" id="sendAmount" placeholder="Enter amount">
      <button onclick="sendMoney()">Send</button>
      <p id="sendStatus"></p>
    </div>

    <div class="section">
      <button onclick="logout()">Logout</button>
    </div>
  </div>

  <script>
    const users = {
      admin: {
        password: "admin123",
        name: "Admin",
        walletId: "ADM001",
        email: "mdgakuo3@gmail.com",
        balances: { KES: 0, BTC: 0, USD: 0, JPY: 0, ETH: 0 }
      },
      schwadz: {
        password: "1234",
        name: "Schwadz",
        walletId: "SCH001",
        email: "mdgakuo2@gmail.com",
        balances: { KES: 0, BTC: 0.0002, USD: 6.4, JPY: 1230, ETH: 0.03 }
      }
    };

    const exchangeRates = {
      KES: { KES: 1, JPY: 1.23, BTC: 0.000002, ETH: 0.00003, USD: 0.0064 },
      JPY: { KES: 0.81, JPY: 1, BTC: 0.0000015, ETH: 0.00002, USD: 0.0075 },
      BTC: { KES: 5200000, JPY: 6700000, BTC: 1, ETH: 15, USD: 65000 },
      ETH: { KES: 350000, JPY: 470000, BTC: 0.066, ETH: 1, USD: 4200 },
      USD: { KES: 155.3, JPY: 133.3, BTC: 0.000015, ETH: 0.00024, USD: 1 }
    };

    let currentUser = null;

    function toggleForm(form) {
      document.getElementById("login").style.display = form === 'login' ? 'block' : 'none';
      document.getElementById("signup").style.display = form === 'signup' ? 'block' : 'none';
    }

    function populateCurrencySelects() {
      const currencies = Object.keys(exchangeRates);
      const fromSel = document.getElementById("fromCurrency");
      const toSel = document.getElementById("toCurrency");
      const preferredSel = document.getElementById("preferredCurrency");
      fromSel.innerHTML = toSel.innerHTML = preferredSel.innerHTML = "";
      currencies.forEach(c => {
        fromSel.innerHTML += `<option value="${c}">${c}</option>`;
        toSel.innerHTML += `<option value="${c}">${c}</option>`;
        preferredSel.innerHTML += `<option value="${c}">${c}</option>`;
      });
    }

    function login() {
      const uname = document.getElementById("loginUsername").value;
      const pwd = document.getElementById("loginPassword").value;
      if (users[uname] && users[uname].password === pwd) {
        currentUser = uname;
        document.getElementById("login").style.display = "none";
        document.getElementById("signup").style.display = "none";
        document.getElementById("dashboard").style.display = "block";
        document.getElementById("userDisplay").innerText = users[uname].name;
        populateCurrencySelects();
        updateWalletDisplay();
        document.getElementById("loginStatus").innerText = "";
      } else {
        document.getElementById("loginStatus").innerText = "Invalid credentials.";
      }
    }

    function signup() {
      const uname = document.getElementById("newUsername").value.trim();
      const pwd = document.getElementById("newPassword").value.trim();
      const email = document.getElementById("email").value.trim();
      const currency = document.getElementById("preferredCurrency").value;
      if (!uname || !pwd || !email || !currency) {
        document.getElementById("signupStatus").innerText = "All fields required.";
        return;
      }
      if (users[uname]) {
        document.getElementById("signupStatus").innerText = "Username already exists.";
        return;
      }
      const walletId = uname.slice(0, 3).toUpperCase() + (Math.floor(Math.random() * 1000)).toString().padStart(3, '0');
      users[uname] = {
        password: pwd,
        name: uname,
        walletId: walletId,
        email: email,
        balances: { KES: 0, BTC: 0, USD: 0, JPY: 0, ETH: 0 }
      };
      users[uname].balances[currency] = 1000 * exchangeRates["KES"][currency];
      document.getElementById("signupStatus").innerText = "Account created. You may log in.";
    }

    function logout() {
      currentUser = null;
      document.getElementById("login").style.display = "block";
      document.getElementById("signup").style.display = "none";
      document.getElementById("dashboard").style.display = "none";
    }

    function updateWalletDisplay() {
      const wallet = users[currentUser].balances;
      const list = document.getElementById("walletList");
      list.innerHTML = "";
      for (let [currency, amount] of Object.entries(wallet)) {
        list.innerHTML += `<li><strong>${currency}</strong>: ${amount.toFixed(2)}</li>`;
      }
    }

    function sendMoney() {
      const from = document.getElementById("fromCurrency").value;
      const to = document.getElementById("toCurrency").value;
      const amount = parseFloat(document.getElementById("sendAmount").value);
      const recipientName = document.getElementById("receiverName").value.trim();
      const recipientWallet = document.getElementById("receiverWallet").value.trim();
      const status = document.getElementById("sendStatus");

      if (!recipientName || !recipientWallet) {
        status.innerText = "Please enter recipient's full legal name and wallet number.";
        return;
      }
      if (!amount || amount <= 0 || isNaN(amount)) {
        status.innerText = "Please enter a valid amount.";
        return;
      }
      if (from === to) {
        status.innerText = "Cannot convert to the same currency.";
        return;
      }
      if (users[currentUser].balances[from] < amount) {
        status.innerText = `Insufficient balance in ${from}.`;
        return;
      }

      let found = null;
      for (const [uname, user] of Object.entries(users)) {
        if (user.walletId === recipientWallet && user.name.toLowerCase() === recipientName.toLowerCase()) {
          found = uname;
          break;
        }
      }

      if (!found) {
        status.innerText = "Recipient not found or details incorrect.";
        return;
      }

      let charge = 0;
      if (from === "KES" && amount > 250) {
        charge = amount * 0.01;
        users[currentUser].balances[from] -= charge;
      }

      const converted = amount * exchangeRates[from][to];
      users[currentUser].balances[from] -= amount;
      users[found].balances[to] += converted;

      updateWalletDisplay();
      status.innerText = `Success! Sent ${amount} ${from} = ${converted.toFixed(2)} ${to} to ${recipientName}. Fee: ${charge.toFixed(2)} KES.`;
      document.getElementById("sendAmount").value = "";
    }

    populateCurrencySelects();
  </script>
</body>
</html>
