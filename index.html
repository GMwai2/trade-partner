<!DOCTYPE html>
<html>
<head>
  <title>Wallet Platform</title>
  <style>
    body { font-family: Arial; margin: 20px; }
    .hidden { display: none; }
    input, select, button { margin: 5px; padding: 6px; }
    .confirmation { border: 1px solid #ccc; padding: 10px; margin-top: 10px; }
  </style>
</head>
<body>

  <h2>Wallet Platform</h2>

  <div id="start-section">
    <button onclick="showSection('login-section')">Login</button>
    <button onclick="showSection('register-section')">Register</button>
  </div>

  <div id="register-section" class="hidden">
    <h3>Register</h3>
    <input id="reg-username" placeholder="Username" />
    <input id="reg-password" type="password" placeholder="Password" />
    <input id="reg-email" placeholder="Email" />
    <input id="reg-pin" placeholder="PIN (4 digits)" />
    <select id="currency">
      <option value="KES">KES</option>
      <option value="USD">USD</option>
      <option value="EUR">EUR</option>
    </select><br>
    <button onclick="register()">Register</button>
    <button onclick="showSection('start-section')">Back</button>
  </div>

  <div id="login-section" class="hidden">
    <h3>Login</h3>
    <input id="login-username" placeholder="Username" />
    <input id="login-password" type="password" placeholder="Password" />
    <button onclick="login()">Login</button>
    <button onclick="showSection('start-section')">Back</button>
  </div>

  <div id="dashboard-section" class="hidden">
    <h3>Dashboard</h3>
    <p>Welcome, <span id="user-name"></span></p>
    <p>Wallet: <span id="wallet-number"></span></p>
    <p>Balance: <span id="wallet-balance"></span></p>
    <div id="admin-panel" class="hidden">
      <p><strong>Admin Panel</strong></p>
      <p>Total Charges Collected: <span id="total-charges"></span></p>
      <p>Registered Users: <span id="user-count"></span></p>
      <h4>Admin Wallet Transfers</h4>
      <input id="admin-transfer-amount" placeholder="Amount to transfer" type="number" />
      <select id="admin-transfer-currency">
        <option value="KES">KES</option>
        <option value="USD">USD</option>
        <option value="EUR">EUR</option>
      </select>
      <button onclick="transferChargesToTrading()">Transfer Charges to Trading Wallet</button>
    </div>
    <h4>Transfer Funds</h4>
    <input id="recipient" placeholder="Recipient Wallet No" />
    <input id="amount" placeholder="Amount" type="number" />
    <input id="auth-pin" placeholder="PIN" />
    <button onclick="prepareTransfer()">Send</button>
    <div id="confirmation-section" class="hidden confirmation">
      <p>Recipient: <span id="confirm-recipient"></span></p>
      <p>Amount: <span id="confirm-amount"></span></p>
      <p>Currency: <span id="confirm-currency"></span></p>
      <button onclick="confirmTransfer()">Next</button>
      <button onclick="cancelTransfer()">Edit</button>
    </div>
    <h4>Transaction History</h4>
    <ul id="history"></ul>
    <button onclick="logout()">Logout</button>
  </div>

  <script>
    let users = {
      'admin': { password: 'admin123', email: 'admin@wallet.com', pin: '0000', wallet: 'ADM001', balance: 100000, role: 'admin', currency: 'KES' },
      'schwadz': { password: 'pass123', email: 'schwadz@wallet.com', pin: '1234', wallet: 'WAL001', balance: 5000, role: 'user', currency: 'USD' },
      'kilush': { password: 'pass456', email: 'kilush@wallet.com', pin: '2345', wallet: 'WAL002', balance: 7000, role: 'user', currency: 'KES' },
      'moses': { password: 'mosespass', email: 'moses@wallet.com', pin: '3456', wallet: 'WAL003', balance: 9000, role: 'user', currency: 'EUR' }
    };

    let exchangeRates = {
      'KES': { 'USD': 0.0069, 'EUR': 0.0063 },
      'USD': { 'KES': 145.2, 'EUR': 0.91 },
      'EUR': { 'KES': 158.5, 'USD': 1.1 }
    };

    function convertCurrency(amount, from, to) {
      if (from === to) return amount;
      return amount * (exchangeRates[from]?.[to] || 1);
    }

    let currentUser = null;
    let totalCharges = { 'KES': 0, 'USD': 0, 'EUR': 0 };
    let transactionLogs = [];
    let recentTransactions = [];

    function showSection(id) {
      document.querySelectorAll('div').forEach(div => div.classList.add('hidden'));
      document.getElementById(id).classList.remove('hidden');
    }

    function register() {
      const username = document.getElementById('reg-username').value.trim();
      const password = document.getElementById('reg-password').value.trim();
      const email = document.getElementById('reg-email').value.trim();
      const pin = document.getElementById('reg-pin').value.trim();
      const currency = document.getElementById('currency').value;

      if (!username || !password || !pin || !email) return alert('All fields required');
      if (users[username]) return alert('Username exists');

      const wallet = 'WAL' + Math.floor(1000 + Math.random() * 9000);
      users[username] = { password, email, pin, wallet, balance: 0, role: 'user', currency };
      alert('Registered successfully. Your wallet number: ' + wallet);
      showSection('login-section');
    }

    function login() {
      const username = document.getElementById('login-username').value.trim();
      const password = document.getElementById('login-password').value.trim();
      const user = users[username];

      if (!user || user.password !== password) return alert('Invalid login');
      currentUser = user;
      showDashboard(username);
    }

    function logout() {
      currentUser = null;
      showSection('start-section');
    }

    function showDashboard(username) {
      document.getElementById('user-name').textContent = username;
      document.getElementById('wallet-number').textContent = currentUser.wallet;
      document.getElementById('wallet-balance').textContent = currentUser.balance.toFixed(2) + ' ' + currentUser.currency;
      document.getElementById('history').innerHTML = transactionLogs.map(t => `<li>${t}</li>`).join('');

      if (currentUser.role === 'admin') {
        document.getElementById('admin-panel').classList.remove('hidden');
        document.getElementById('total-charges').textContent = Object.entries(totalCharges).map(([cur, amt]) => `${amt.toFixed(2)} ${cur}`).join(', ');
        document.getElementById('user-count').textContent = Object.keys(users).length;
      } else {
        document.getElementById('admin-panel').classList.add('hidden');
      }

      showSection('dashboard-section');
    }

    function prepareTransfer() {
      const toWallet = document.getElementById('recipient').value.trim();
      const amount = parseFloat(document.getElementById('amount').value);
      const pin = document.getElementById('auth-pin').value.trim();

      if (pin !== currentUser.pin) return alert('Wrong PIN');
      if (amount <= 0 || isNaN(amount)) return alert('Invalid amount');

      const recipient = Object.values(users).find(u => u.wallet === toWallet);
      if (!recipient) return alert('Recipient not found');
      if (recipient.wallet === currentUser.wallet) return alert('Cannot send to self');

      document.getElementById('confirm-recipient').textContent = recipient.wallet;
      document.getElementById('confirm-amount').textContent = amount.toFixed(2);
      document.getElementById('confirm-currency').textContent = currentUser.currency;
      document.getElementById('confirmation-section').classList.remove('hidden');
    }

    function cancelTransfer() {
      document.getElementById('confirmation-section').classList.add('hidden');
    }

    function confirmTransfer() {
      const toWallet = document.getElementById('recipient').value.trim();
      const amount = parseFloat(document.getElementById('amount').value);
      const recipient = Object.values(users).find(u => u.wallet === toWallet);

      const now = Date.now();
      const duplicate = recentTransactions.find(t =>
        t.sender === currentUser.wallet &&
        t.recipient === recipient.wallet &&
        t.amount === amount &&
        t.currency === currentUser.currency &&
        now - t.timestamp < 60000
      );
      if (duplicate) return alert('Duplicate transaction detected. Please wait before retrying.');

      const charge = amount * 0.01;
      const total = amount + charge;

      if (currentUser.balance < total) return alert('Insufficient balance');

      let convertedAmount = amount;
      let note = '';
      if (currentUser.currency !== recipient.currency) {
        convertedAmount = convertCurrency(amount, currentUser.currency, recipient.currency);
        note = ` (converted from ${amount.toFixed(2)} ${currentUser.currency} to ${convertedAmount.toFixed(2)} ${recipient.currency})`;
      }

      currentUser.balance -= total;
      recipient.balance += convertedAmount;
      totalCharges[currentUser.currency] += charge;

      const log = `${currentUser.wallet} sent ${convertedAmount.toFixed(2)} ${recipient.currency} to ${recipient.wallet}${note} (+${
::contentReference[oaicite:5]{index=5}
 
