<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Wallet Platform</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    .hidden { display: none; }
    input, select, button { margin: 5px; padding: 6px; }
    #confirmation-section { border: 1px solid #ccc; padding: 10px; margin-top: 10px; }
    canvas { max-width: 400px; margin: 10px; }
  </style>
</head>
<body>

  <h2>Wallet Platform</h2>

  <div id="start-section">
    <button onclick="showSection('login-section')">Login</button>
    <button onclick="showSection('register-section')">Register</button>
  </div>

  <div id="register-section" class="hidden">
    <h3>Register</h3>
    <input id="reg-username" placeholder="Username" />
    <input id="reg-password" type="password" placeholder="Password" />
    <input id="reg-email" placeholder="Email" />
    <input id="reg-pin" placeholder="PIN (4 digits)" />
    <select id="currency">
      <option value="KES">KES</option>
      <option value="USD">USD</option>
      <option value="EUR">EUR</option>
    </select><br>
    <button onclick="register()">Register</button>
    <button onclick="showSection('start-section')">Back</button>
  </div>

  <div id="login-section" class="hidden">
    <h3>Login</h3>
    <input id="login-username" placeholder="Username" />
    <input id="login-password" type="password" placeholder="Password" />
    <button onclick="login()">Login</button>
    <button onclick="showSection('start-section')">Back</button>
  </div>

  <div id="dashboard-section" class="hidden">
    <h3>Dashboard</h3>
    <p>Welcome, <span id="user-name"></span></p>
    <p>Wallet: <span id="wallet-number"></span></p>
    <p>Balance: <span id="wallet-balance"></span></p>

    <div id="admin-panel" class="hidden">
      <p><strong>Admin Panel</strong></p>
      <p>Total Charges Collected:</p>
      <ul id="charges-list"></ul>
      <p>Registered Users: <span id="user-count"></span></p>
      <button onclick="showSection('subadmin-section')">Manage Sub-Admins</button>
      <button onclick="showSection('transfer-charges-section')">Transfer Charges to Trading Wallet</button>
      <div>
        <canvas id="transactionsChart"></canvas>
        <canvas id="balancesChart"></canvas>
      </div>
    </div>

    <h4>Transfer Funds</h4>
    <input id="recipient" placeholder="Recipient Wallet No" />
    <input id="amount" placeholder="Amount" type="number" />
    <input id="auth-pin" placeholder="PIN" />
    <button onclick="prepareTransfer()">Next</button>

    <div id="confirmation-section" class="hidden">
      <p>Recipient: <span id="confirm-recipient"></span></p>
      <p>Amount: <span id="confirm-amount"></span></p>
      <button onclick="confirmTransfer()">Confirm</button>
      <button onclick="cancelTransfer()">Edit</button>
    </div>

    <h4>Transaction History</h4>
    <ul id="history"></ul>
    <button onclick="logout()">Logout</button>
  </div>

  <div id="subadmin-section" class="hidden">
    <h3>Manage Sub-Admins</h3>
    <input id="subadmin-username" placeholder="Username" />
    <input id="subadmin-password" type="password" placeholder="Password" />
    <input id="subadmin-email" placeholder="Email" />
    <input id="subadmin-pin" placeholder="PIN (4 digits)" />
    <select id="subadmin-permissions" multiple>
      <option value="logs">Logs</option>
      <option value="graphs">Graphs</option>
      <option value="user-data">User Data</option>
    </select><br>
    <button onclick="createSubAdmin()">Create Sub-Admin</button>
    <button onclick="showSection('dashboard-section')">Back</button>
  </div>

  <div id="transfer-charges-section" class="hidden">
    <h3>Transfer Charges to Trading Wallet</h3>
    <select id="transfer-currency">
      <option value="KES">KES</option>
      <option value="USD">USD</option>
      <option value="EUR">EUR</option>
    </select>
    <input id="transfer-amount" placeholder="Amount" type="number" />
    <button onclick="transferCharges()">Transfer</button>
    <button onclick="showSection('dashboard-section')">Back</button>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    let users = {
      'admin': { password: 'admin123', email: 'admin@wallet.com', pin: '0000', wallet: 'ADM001', balance: 100000, role: 'admin', currency: 'KES', permissions: [] },
      'schwadz': { password: 'pass123', email: 'schwadz@wallet.com', pin: '1234', wallet: 'WAL001', balance: 5000, role: 'user', currency: 'USD' },
      'kilush': { password: 'pass456', email: 'kilush@wallet.com', pin: '2345', wallet: 'WAL002', balance: 7000, role: 'user', currency: 'KES' },
      'moses': { password: 'mosespass', email: 'moses@wallet.com', pin: '3456', wallet: 'WAL003', balance: 9000, role: 'user', currency: 'EUR' }
    };

    let exchangeRates = {
      'KES': { 'USD': 0.0069, 'EUR': 0.0063 },
      'USD': { 'KES': 145.2, 'EUR': 0.91 },
      'EUR': { 'KES': 158.5, 'USD': 1.1 }
    };

    function convertCurrency(amount, from, to) {
      if (from === to) return amount;
      return amount * (exchangeRates[from]?.[to] || 1);
    }

    let currentUser = null;
    let totalCharges = { 'KES': 0, 'USD': 0, 'EUR': 0 };
    let transactionLogs = [];

    function showSection(id) {
      document.querySelectorAll('div').forEach(div => div.classList.add('hidden'));
      document.getElementById(id).classList.remove('hidden');
    }

    function register() {
      const username = document.getElementById('reg-username').value.trim();
      const password = document.getElementById('reg-password').value.trim();
      const email = document.getElementById('reg-email').value.trim();
      const pin = document.getElementById('reg-pin').value.trim();
      const currency = document.getElementById('currency').value;

      if (!username || !password || !pin || !email) {
        alert('All fields are required');
        return;
      }
      if (users[username]) {
        alert('Username already exists');
        return;
      }

      const wallet = 'WAL' + Math.floor(1000 + Math.random() * 9000);
      users[username] = { password, email, pin, wallet, balance: 0, role: 'user', currency };
      alert('Registered successfully. Your wallet number: ' + wallet);
      showSection('login-section');
    }

    function login() {
      const username = document.getElementById('login-username').value.trim();
      const password = document.getElementById('login-password').value.trim();
      const user = users[username];

      if (!user || user.password !== password) {
        alert('Invalid login credentials');
        return;
      }
      currentUser = user;
      showDashboard(username);
    }

    function logout() {
      currentUser = null;
      showSection('start-section');
    }

    function showDashboard(username) {
      document.getElementById('user-name').textContent = username;
      document.getElementById('wallet-number').textContent = currentUser.wallet;
      document.getElementById('wallet-balance').textContent = currentUser.balance.toFixed(2) + ' ' + currentUser.currency;
      document.getElementById('history').innerHTML = transactionLogs.map(t => `<li>${t}</li>`).join('');

      if (currentUser.role === 'admin') {
        document.getElementById('admin-panel').classList.remove('hidden');
        updateChargesList();
        document.getElementById('user-count').textContent = Object.keys(users).length;
        renderCharts();
      } else {
        document.getElementById('admin-panel').classList.add('hidden');
      }

      showSection('dashboard-section');
    }

    function updateChargesList() {
      const chargesList = document.getElementById('charges-list');
      chargesList.innerHTML = '';
      for (let currency in totalCharges) {
        const li = document.createElement('li');
        li.textContent = `${currency}: ${total
::contentReference[oaicite:20]{index=20}
 
