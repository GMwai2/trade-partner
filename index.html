<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Demo Wallet Platform</title>
<style>
  body { font-family: Arial, sans-serif; background: #f5f5f5; margin:0; padding:0; }
  .container { max-width: 400px; margin: 50px auto; background: white; padding: 20px; border-radius: 6px; box-shadow: 0 0 12px rgba(0,0,0,0.1);}
  h2 { text-align: center; }
  label { display: block; margin: 10px 0 5px; }
  input[type=text], input[type=password], input[type=email], input[type=tel], input[type=number] {
    width: 100%; padding: 8px; box-sizing: border-box; border-radius: 4px; border: 1px solid #ccc;
  }
  button { width: 100%; padding: 10px; margin-top: 15px; background: #007BFF; border:none; border-radius:4px; color: white; font-size: 16px; cursor: pointer;}
  button:hover { background: #0056b3; }
  .link-button { background: none; border: none; color: #007BFF; cursor: pointer; margin-top: 10px; font-size: 14px; }
  .link-button:hover { text-decoration: underline; }
  .error { color: red; margin-top: 10px; }
  .dashboard { text-align: center; }
  .logout-btn { background: #dc3545; margin-top: 20px; }
  .admin-msg { background: #ffeeba; padding: 10px; border-radius: 4px; margin-top: 10px; }
</style>
</head>
<body>

<div class="container" id="start-page">
  <h2>Welcome to Demo Wallet</h2>
  <button id="btn-login">Login</button>
  <button id="btn-register">Register</button>
</div>

<div class="container" id="login-form" style="display:none;">
  <h2>Login</h2>
  <label for="login-username">Username</label>
  <input type="text" id="login-username" autocomplete="username" />
  <label for="login-password">Password</label>
  <input type="password" id="login-password" autocomplete="current-password" />
  <button id="login-submit">Login</button>
  <button class="link-button" id="login-to-start">Back</button>
  <div class="error" id="login-error"></div>
</div>

<div class="container" id="register-form" style="display:none;">
  <h2>Register</h2>
  <label for="reg-surname">Surname</label>
  <input type="text" id="reg-surname" />
  <label for="reg-middle">Middle Name (optional)</label>
  <input type="text" id="reg-middle" />
  <label for="reg-first">First Name</label>
  <input type="text" id="reg-first" />
  <label for="reg-id">ID / Passport Number</label>
  <input type="text" id="reg-id" />
  <label for="reg-phone">Phone Number</label>
  <input type="tel" id="reg-phone" />
  <label for="reg-email">Email Address</label>
  <input type="email" id="reg-email" />
  <label for="reg-password">Password</label>
  <input type="password" id="reg-password" />
  <label for="reg-pin">4-digit PIN</label>
  <input type="number" id="reg-pin" min="1000" max="9999" />
  <button id="register-submit">Register</button>
  <button class="link-button" id="register-to-start">Back</button>
  <div class="error" id="register-error"></div>
</div>

<div class="container" id="dashboard" style="display:none;">
  <h2>Dashboard</h2>
  <div id="welcome-msg"></div>
  <div id="wallet-balance"></div>
  <div id="admin-section" style="display:none;">
    <div class="admin-msg">You are logged in as <b>Admin</b>.</div>
    <p>Admin Dashboard content here.</p>
  </div>
  <button id="logout-btn" class="logout-btn">Logout</button>
</div>

<script>
(() => {
  // Utility
  function $(id) { return document.getElementById(id); }

  // Elements
  const startPage = $('start-page');
  const loginForm = $('login-form');
  const registerForm = $('register-form');
  const dashboard = $('dashboard');

  const loginError = $('login-error');
  const registerError = $('register-error');

  // Navigation buttons
  $('btn-login').onclick = () => {
    startPage.style.display = 'none';
    loginForm.style.display = 'block';
    loginError.textContent = '';
    $('login-username').focus();
  };

  $('btn-register').onclick = () => {
    startPage.style.display = 'none';
    registerForm.style.display = 'block';
    registerError.textContent = '';
    $('reg-surname').focus();
  };

  $('login-to-start').onclick = () => {
    loginForm.style.display = 'none';
    startPage.style.display = 'block';
  };

  $('register-to-start').onclick = () => {
    registerForm.style.display = 'none';
    startPage.style.display = 'block';
  };

  // Logout button
  $('logout-btn').onclick = () => {
    dashboard.style.display = 'none';
    startPage.style.display = 'block';
    currentUser = null;
  };

  // Hardcoded admin user (will merge with localStorage users)
  const adminUser = {
    username: 'admin',
    password: 'admin123',
    surname: 'Admin',
    middleName: '',
    firstName: 'User',
    idNumber: '00000000',
    phone: '0000000000',
    email: 'admin@demo.com',
    pin: '1234',
    walletBalance: 1000000,
    isAdmin: true,
  };

  // Get users from localStorage or initialize with admin
  function getUsers() {
    const users = JSON.parse(localStorage.getItem('demoUsers'));
    if (!users) {
      localStorage.setItem('demoUsers', JSON.stringify([adminUser]));
      return [adminUser];
    }
    // Ensure admin always exists (merge)
    if (!users.some(u => u.username === adminUser.username)) {
      users.push(adminUser);
      localStorage.setItem('demoUsers', JSON.stringify(users));
    }
    return users;
  }

  // Save users array back to localStorage
  function saveUsers(users) {
    localStorage.setItem('demoUsers', JSON.stringify(users));
  }

  // Generate username based on ID number
  function generateUsername(id) {
    return id.toLowerCase();
  }

  // Validate registration inputs
  function validateRegistration(data) {
    if (!data.surname.trim()) return 'Surname is required';
    if (!data.firstName.trim()) return 'First Name is required';
    if (!data.idNumber.trim()) return 'ID / Passport Number is required';
    if (!data.phone.trim()) return 'Phone Number is required';
    if (!data.email.trim()) return 'Email Address is required';
    if (!data.password || data.password.length < 6) return 'Password must be at least 6 characters';
    if (!data.pin || data.pin.length !== 4 || isNaN(data.pin)) return 'PIN must be a 4-digit number';
    return null;
  }

  // Current logged in user
  let currentUser = null;

  // Register Submit Handler
  $('register-submit').onclick = () => {
    registerError.textContent = '';

    const userData = {
      surname: $('reg-surname').value.trim(),
      middleName: $('reg-middle').value.trim(),
      firstName: $('reg-first').value.trim(),
      idNumber: $('reg-id').value.trim(),
      phone: $('reg-phone').value.trim(),
      email: $('reg-email').value.trim(),
      password: $('reg-password').value,
      pin: $('reg-pin').value,
      walletBalance: 0,
      isAdmin: false,
    };

    const validationError = validateRegistration(userData);
    if (validationError) {
      registerError.textContent = validationError;
      return;
    }

    // Generate username from id
    userData.username = generateUsername(userData.idNumber);

    let users = getUsers();
    if (users.some(u => u.username === userData.username)) {
      registerError.textContent = 'User with this ID already exists. Please login.';
      return;
    }

    users.push(userData);
    saveUsers(users);

    alert('Registration successful! Please login now.');

    // Reset form and go back to start page
    registerForm.reset();
    registerForm.style.display = 'none';
    startPage.style.display = 'block';
  };

  // Login Submit Handler
  $('login-submit').onclick = () => {
    loginError.textContent = '';
    const username = $('login-username').value.trim().toLowerCase();
    const password = $('login-password').value;

    if (!username || !password) {
      loginError.textContent = 'Please enter username and password';
      return;
    }

    const users = getUsers();
    const user = users.find(u => u.username === username && u.password === password);
    if (!user) {
      loginError.textContent = 'Invalid username or password';
      return;
    }

    currentUser = user;
    showDashboard(user);

    // Clear login form and hide it
    loginForm.reset();
    loginForm.style.display = 'none';
  };

  // Show Dashboard
  function showDashboard(user) {
    startPage.style.display = 'none';
    registerForm.style.display = 'none';
    loginForm.style.display = 'none';
    dashboard.style.display = 'block';

    $('welcome-msg').textContent = `Welcome, ${user.surname} ${user.middleName} ${user.firstName}`.replace(/\s+/g, ' ').trim();
    $('wallet-balance').textContent = `Wallet Balance: KES ${user.walletBalance.toLocaleString()}`;

    if (user.isAdmin) {
      $('admin-section').style.display = 'block';
    } else {
      $('admin-section').style.display = 'none';
    }
  }

  // On load: just show start page
  startPage.style.display = 'block';
  loginForm.style.display = 'none';
  registerForm.style.display = 'none';
  dashboard.style.display = 'none';

})();
</script>

</body>
</html>
