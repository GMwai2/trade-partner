<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Trade Partner Wallet - Secure Access</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 600px;
      margin: 40px auto;
      padding: 20px;
      background-color: #f2f4f8;
      border-radius: 10px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
    }
    h2, h3 {
      text-align: center;
    }
    label, select, input, button {
      width: 100%;
      margin: 10px 0;
      padding: 10px;
    }
    .section {
      background: #ffffff;
      padding: 15px;
      border-radius: 8px;
      margin-top: 20px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    ul {
      padding-left: 20px;
    }
    #dashboard, #register { display: none; }
  </style>
</head>
<body>
  <h2>Trade Partner Wallet</h2>

  <div id="login" class="section">
    <h3>User Login</h3>
    <label for="username">Username:</label>
    <input type="text" id="username" placeholder="Enter username">
    <label for="password">Password:</label>
    <input type="password" id="password" placeholder="Enter password">
    <button onclick="login()">Login</button>
    <p id="loginStatus" style="color: red;"></p>
    <p>New user? <a href="#" onclick="showRegister()">Register here</a></p>
  </div>

  <div id="register" class="section">
    <h3>User Registration</h3>
    <label for="regName">Full Legal Name:</label>
    <input type="text" id="regName" placeholder="Full name">
    <label for="regUsername">Username:</label>
    <input type="text" id="regUsername" placeholder="Choose a username">
    <label for="regPassword">Password:</label>
    <input type="password" id="regPassword" placeholder="Choose a password">
    <label for="regCurrency">Preferred Currency:</label>
    <select id="regCurrency"></select>
    <button onclick="registerUser()">Create Account</button>
    <p id="registerStatus"></p>
  </div>

  <div id="dashboard">
    <div class="section">
      <h3>Welcome, <span id="userDisplay"></span></h3>
      <h4>Your Wallet</h4>
      <ul id="walletList"></ul>
    </div>

    <div class="section">
      <h3>Send Money</h3>
      <label for="receiverName">Recipient Legal Name:</label>
      <input type="text" id="receiverName" placeholder="Full legal name">
      <label for="receiverWallet">Recipient Wallet Number:</label>
      <input type="text" id="receiverWallet" placeholder="Wallet ID">
      <label for="fromCurrency">From Currency:</label>
      <select id="fromCurrency"></select>
      <label for="toCurrency">To Currency:</label>
      <select id="toCurrency"></select>
      <label for="sendAmount">Amount to Send:</label>
      <input type="number" id="sendAmount" placeholder="Enter amount">
      <button onclick="sendMoney()">Send</button>
      <p id="sendStatus"></p>
    </div>

    <div class="section">
      <button onclick="logout()">Logout</button>
    </div>
  </div>

  <script>
    const users = {
      alice: {
        password: "1234",
        name: "Alice Njeri",
        walletId: "ALC001",
        balances: { KES: 1000, BTC: 0.02, USD: 0, JPY: 0, ETH: 0 }
      },
      bob: {
        password: "5678",
        name: "Bob Watanabe",
        walletId: "BOB001",
        balances: { JPY: 5000, ETH: 1.5, USD: 0, BTC: 0, KES: 0 }
      }
    };

    let userCount = 2; // 2 preloaded users

    const exchangeRates = {
      KES: { KES: 1, JPY: 1.23, BTC: 0.000002, ETH: 0.00003, USD: 0.0064 },
      JPY: { KES: 0.81, JPY: 1, BTC: 0.0000015, ETH: 0.00002, USD: 0.0075 },
      BTC: { KES: 5200000, JPY: 6700000, BTC: 1, ETH: 15, USD: 65000 },
      ETH: { KES: 350000, JPY: 470000, BTC: 0.066, ETH: 1, USD: 4200 },
      USD: { KES: 155.3, JPY: 133.3, BTC: 0.000015, ETH: 0.00024, USD: 1 }
    };

    let currentUser = null;

    function showRegister() {
      populateCurrencySelects();
      document.getElementById("login").style.display = "none";
      document.getElementById("register").style.display = "block";
    }

    function login() {
      const uname = document.getElementById("username").value;
      const pwd = document.getElementById("password").value;
      if (users[uname] && users[uname].password === pwd) {
        currentUser = uname;
        document.getElementById("login").style.display = "none";
        document.getElementById("dashboard").style.display = "block";
        document.getElementById("userDisplay").innerText = users[uname].name;
        populateCurrencySelects();
        updateWalletDisplay();
        document.getElementById("loginStatus").innerText = "";
      } else {
        document.getElementById("loginStatus").innerText = "Invalid credentials.";
      }
    }

    function logout() {
      currentUser = null;
      document.getElementById("login").style.display = "block";
      document.getElementById("dashboard").style.display = "none";
      document.getElementById("register").style.display = "none";
    }

    function populateCurrencySelects() {
      const currencies = Object.keys(exchangeRates);
      ["fromCurrency", "toCurrency", "regCurrency"].forEach(id => {
        const sel = document.getElementById(id);
        if (!sel) return;
        sel.innerHTML = "";
        currencies.forEach(c => {
          sel.innerHTML += `<option value="${c}">${c}</option>`;
        });
      });
    }

    function updateWalletDisplay() {
      const wallet = users[currentUser].balances;
      const list = document.getElementById("walletList");
      list.innerHTML = "";
      for (let [currency, amount] of Object.entries(wallet)) {
        list.innerHTML += `<li><strong>${currency}</strong>: ${amount.toFixed(2)}</li>`;
      }
    }

    function sendMoney() {
      const from = document.getElementById("fromCurrency").value;
      const to = document.getElementById("toCurrency").value;
      const amount = parseFloat(document.getElementById("sendAmount").value);
      const recipientName = document.getElementById("receiverName").value.trim();
      const recipientWallet = document.getElementById("receiverWallet").value.trim();
      const status = document.getElementById("sendStatus");

      if (!recipientName || !recipientWallet) {
        status.innerText = "Please enter recipient's full legal name and wallet number.";
        return;
      }
      if (!amount || amount <= 0 || isNaN(amount)) {
        status.innerText = "Please enter a valid amount.";
        return;
      }
      if (from === to) {
        status.innerText = "Cannot convert to the same currency.";
        return;
      }
      if (users[currentUser].balances[from] < amount) {
        status.innerText = `Insufficient balance in ${from}.`;
        return;
      }

      let found = null;
      for (const [uname, user] of Object.entries(users)) {
        if (user.walletId === recipientWallet && user.name.toLowerCase() === recipientName.toLowerCase()) {
          found = uname;
          break;
        }
      }

      if (!found) {
        status.innerText = "Recipient not found or details incorrect.";
        return;
      }

      const converted = amount * exchangeRates[from][to];
      users[currentUser].balances[from] -= amount;
      users[found].balances[to] += converted;

      updateWalletDisplay();
      status.innerText = `Success! Sent ${amount} ${from} = ${converted.toFixed(2)} ${to} to ${recipientName}`;
      document.getElementById("sendAmount").value = "";
    }

    function registerUser() {
      const name = document.getElementById("regName").value.trim();
      const uname = document.getElementById("regUsername").value.trim();
      const pwd = document.getElementById("regPassword").value;
      const currency = document.getElementById("regCurrency").value;
      const status = document.getElementById("registerStatus");

      if (userCount >= 5) {
        status.innerText = "Registration limit reached for demo (3 new users).";
        return;
      }
      if (!name || !uname || !pwd || !currency) {
        status.innerText = "All fields are required.";
        return;
      }
      if (users[uname]) {
        status.innerText = "Username already exists.";
        return;
      }

      const walletId = uname.toUpperCase().substring(0, 3) + Math.floor(Math.random() * 1000);
      const initBalances = {};
      for (let cur of Object.keys(exchangeRates)) initBalances[cur] = 0;
      initBalances[currency] = 1000;

      users[uname] = {
        password: pwd,
        name: name,
        walletId: walletId,
        balances: initBalances
      };

      userCount++;
      status.innerText = "Registration successful! You can now log in.";
    }
  </script>
</body>
</html>
